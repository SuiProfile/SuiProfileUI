import{r as h,j as n}from"./index-CEo2IlR3.js";const oe={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function le(t){let r=t.trim();return/^https?:\/\//i.test(r)?r:/^www\./i.test(r)?`https://${r}`:/^[a-z0-9.-]+\.[a-z]{2,}(\/.*)?$/i.test(r)?`https://${r}`:`https://${r}`}async function Y(t,r={},i=5e3){const s=new AbortController,o=setTimeout(()=>s.abort(),i);try{return await fetch(t,{...r,signal:s.signal,redirect:"follow",mode:"cors"})}finally{clearTimeout(o)}}function ce(t,r){const i=t.match(/<title>([^<]*)<\/title>/i),s=i?i[1].trim():null,o=t.match(/<meta[^>]*name=["']description["'][^>]*content=["']([^"']*)["'][^>]*>/i),m=o?o[1].trim():null;let d=null;const v=t.match(/<link[^>]*rel=["'](?:icon|shortcut icon)["'][^>]*href=["']([^"']+)["'][^>]*>/i);if(v){const y=v[1];try{d=new URL(y,r).toString()}catch{d=null}}else try{d=`${new URL(r).origin}/favicon.ico`}catch{d=null}return{title:s,description:m,favicon:d}}async function de(t,r={}){const i=performance.now(),s=le(t),o=r.timeoutMs??6e3,m=typeof import.meta<"u"&&oe&&!1;try{let d=null;try{d=await Y(s,{method:"HEAD"},o)}catch{}(!d||!d.ok&&d.status!==405)&&(d=await Y(s,{method:"GET"},o));const v=Math.round(performance.now()-i),y={url:t,normalizedUrl:s,reachable:d.ok,status:d.status,finalUrl:d.url,title:null,description:null,favicon:null,elapsedMs:v},j=d.headers.get("content-type")||"";if(d.ok&&/text\/html/i.test(j))try{const S=await d.text(),b=ce(S,d.url);y.title=b.title,y.description=b.description,y.favicon=b.favicon}catch{}return y}catch(d){return{url:t,normalizedUrl:s,reachable:!1,error:d?.name==="AbortError"?"timeout":String(d?.message||d),elapsedMs:Math.round(performance.now()-i)}}}function F(){return typeof window<"u"&&typeof document<"u"}function ue(){if(!F())return null;try{const t=window.localStorage,r="__storage_test__";return t.setItem(r,"1"),t.removeItem(r),t}catch{return null}}function me(){const t=new Map;return{get length(){return t.size},clear(){t.clear()},getItem(r){return t.has(r)?t.get(r):null},key(r){return r<0||r>=t.size?null:Array.from(t.keys())[r]??null},removeItem(r){t.delete(r)},setItem(r,i){t.set(r,String(i))}}}function ge(t){const r=new Set,i={get length(){return t.length},clear(){const s=[];for(let o=0;o<t.length;o++){const m=t.key(o);m&&s.push(m)}t.clear(),s.forEach(o=>r.forEach(m=>m(o,null,null)))},getItem(s){return t.getItem(s)},key(s){return t.key(s)},removeItem(s){const o=t.getItem(s);t.removeItem(s),r.forEach(m=>m(s,null,o))},setItem(s,o){const m=t.getItem(s);t.setItem(s,o),r.forEach(d=>d(s,o,m))},has(s){return i.getItem(s)!==null},setJSON(s,o){i.setItem(s,JSON.stringify(o))},getJSON(s,o){const m=i.getItem(s);if(m==null)return o??null;try{return JSON.parse(m)}catch{return o??null}},onChange(s){return r.add(s),()=>r.delete(s)}};return F()&&window.addEventListener("storage",s=>{s.key&&r.forEach(o=>o(s.key,s.newValue,s.oldValue))}),i}const fe=ue(),pe=fe??me(),_=ge(pe),W="links-page-state-v2";function he(){const t=_.getJSON(W);return t&&Array.isArray(t.groups)&&Array.isArray(t.library)?{groups:t.groups,library:t.library}:{groups:[],library:[]}}function N(t){const r={groups:Array.isArray(t.groups)?t.groups:[],library:Array.isArray(t.library)?t.library:[]};r&&(r.groups.length>0||r.library.length>0)&&_.setJSON(W,r)}function xe(t){let r=0;for(const i of t){const s=parseInt(i.id,10);!isNaN(s)&&s>r&&(r=s)}return String(r+1)}function ye(t,r){let i=0;for(const s of r){const o=parseInt(s.id,10);!isNaN(o)&&o>i&&(i=o)}for(const s of t)for(const o of s.links){const m=parseInt(o.id,10);!isNaN(m)&&m>i&&(i=m)}return String(i+1)}function be(t,r){return t.links.length>=10?{ok:!1,reason:"max"}:t.links.some(i=>i.url===r.url)?{ok:!1,reason:"dup"}:{ok:!0}}const Z=60,ke=200,ve=32;function Ne(){const[t,r]=h.useState([]),[i,s]=h.useState([]),[o,m]=h.useState(""),[d,v]=h.useState(""),[y,j]=h.useState(""),[S,b]=h.useState(""),[q,z]=h.useState(!1),[Q,M]=h.useState(!1),I=/^https?:\/\/([a-zA-Z0-9-_]+\.)+[a-zA-Z]{2,}(\/\S*)?$/i,[L,A]=h.useState(null),p=(e,a="error")=>{A({message:e,type:a}),window.clearTimeout(p._t),p._t=window.setTimeout(()=>A(null),2200)};h.useEffect(()=>{const e=he();r(e.groups),s(e.library),b(e.groups[0]?.id??"")},[]),h.useEffect(()=>{N({groups:t,library:i})},[t,i]),h.useMemo(()=>t.map(e=>({id:e.id,name:e.name})),[t]);const O=h.useRef(1);h.useEffect(()=>{O.current=parseInt(xe(t),10)},[]);const $=()=>{const e=o.trim();if(t.length>=5){p("En fazla 5 grup oluşturabilirsiniz");return}if(!e){p("Grup adı boş olamaz");return}if(e.length<2){p("Grup adı en az 2 karakter olmalı");return}const a=(O.current++).toString();r(l=>[...l,{id:a,name:e,links:[]}]),m(""),S||b(a),z(!0),setTimeout(()=>z(!1),600),p("Grup eklendi","success")},T=h.useRef(1),ee=()=>(T.current++).toString();h.useEffect(()=>{T.current=parseInt(ye(t,i),10)},[]);const B=async()=>{const e=d.trim(),a=y.trim();if(!e){p("Başlık boş olamaz");return}if(e.length<2){p("Başlık en az 2 karakter olmalı");return}if(!a){p("URL boş olamaz");return}if(!I.test(a)){p("URL https:// veya http:// ile başlamalı");return}M(!0);try{const l=await de(a,{timeoutMs:6e3});if(!l.reachable){p(`Siteye ulaşılamadı${l.status?` (status ${l.status})`:l.error?` (${l.error})`:""}`);return}const c=l.normalizedUrl||a;if(i.some(x=>x.url===c)){p("Bu link zaten kütüphanede var");return}const u=(e||l.title||"").toString().slice(0,Z)||c,g={id:ee(),text:u,url:c,favicon:l.favicon||void 0};s(x=>[g,...x]),v(""),j(""),p("Link eklendi","success")}finally{M(!1)}},te=(e,a)=>{r(l=>{const c=l.map(u=>u.id===e?{...u,links:u.links.filter(g=>g.id!==a)}:u);return N({groups:c,library:i}),p("Link silindi","success"),c})},re=e=>{r(a=>{const l=a.filter(c=>c.id!==e);return N({groups:l,library:i}),S===e&&l.length>0?b(l[0].id):l.length===0&&b(""),_.removeItem(e),p("Grup silindi","success"),l})},R=(e,a)=>{e.dataTransfer.setData("application/json",JSON.stringify(a)),e.dataTransfer.effectAllowed="move"},ne=e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},se=(e,a)=>{e.preventDefault(),e.stopPropagation();const l=e.dataTransfer.getData("application/json");if(!l)return;const c=JSON.parse(l);if(c.from==="library"){const u=i.find(g=>g.id===c.linkId);if(!u)return;C(a,u,void 0)}else J(c.fromGroupId,a,c.linkId,void 0)},U=(e,a,l)=>{e.preventDefault(),e.stopPropagation();const c=e.dataTransfer.getData("application/json");if(!c)return;const u=JSON.parse(c);if(u.from==="library"){const g=i.find(x=>x.id===u.linkId);if(!g)return;C(a,g,l)}else J(u.fromGroupId,a,u.linkId,l)},C=(e,a,l)=>{r(c=>{const u=c.map(g=>{if(g.id!==e)return g;const x=be(g,a);if(!x.ok)return p(x.reason==="max"?"Bu grupta en fazla 10 link olabilir":"Bu link zaten grupta var"),g;const k=[...g.links],E=(T.current++).toString(),w={...a,id:E},G=l===void 0?k.length:Math.max(0,Math.min(l,k.length));return k.splice(G,0,w),{...g,links:k}});return N({groups:u,library:i}),u})},J=(e,a,l,c)=>{!e||!a||!l||r(u=>{const g=u.find(f=>f.id===e),x=u.find(f=>f.id===a);if(!g||!x)return u;const k=g.links.find(f=>f.id===l);if(!k)return u;if(e===a){const f=[...g.links],V=f.findIndex(D=>D.id===l);if(V===-1)return u;const ae=c===void 0?f.length-1:Math.max(0,Math.min(c,f.length-1)),[ie]=f.splice(V,1);f.splice(ae,0,ie);const H={...g,links:f},X=u.map(D=>D.id===H.id?H:D);return N({groups:X,library:i}),X}if(x.links.length>=10)return p("Bu grupta en fazla 10 link olabilir"),u;if(x.links.some(f=>f.url===k.url))return p("Bu link zaten grupta var"),u;const E={...g,links:g.links.filter(f=>f.id!==l)},w=[...x.links],G=c===void 0?w.length:Math.max(0,Math.min(c,w.length));w.splice(G,0,k);const K={...x,links:w},P=u.map(f=>f.id===E.id?E:f.id===K.id?K:f);return N({groups:P,library:i}),P})};return n.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 py-4",children:[n.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow-md p-4 sm:p-6 mb-6 grid grid-cols-1 lg:grid-cols-3 gap-4",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Yeni Grup"}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx("input",{value:o,onChange:e=>m(e.currentTarget.value),maxLength:ve,className:`flex-1 max-w-xs rounded-lg border bg-white dark:bg-gray-900 px-3 py-2 outline-none focus:ring-2 focus:ring-[#2665D6] ${o&&o.trim().length<2?"border-red-400 dark:border-red-500":"border-gray-300 dark:border-gray-700"}`,placeholder:"Örn: Sosyal, İş, Kişisel",onKeyDown:e=>{e.key==="Enter"&&$()}}),n.jsxs("button",{type:"button",onClick:$,className:"px-4 py-2 rounded-lg text-sm font-semibold text-white flex items-center gap-2",style:{background:"linear-gradient(135deg, #2665D6 0%, #E6291B 100%)"},children:[q&&n.jsx("span",{className:"w-4 h-4 border-2 border-white/60 border-t-white rounded-full animate-spin"}),n.jsx("span",{children:"Ekle"})]})]})]}),n.jsxs("div",{className:"lg:col-span-2",children:[n.jsx("h3",{className:"text-sm font-semibold mb-2",children:"Yeni Link (kütüphaneye eklenir, gruplara sürükleyin)"}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-[1fr_1fr_auto_auto] gap-2 items-stretch",children:[n.jsx("input",{value:d,onChange:e=>v(e.currentTarget.value),maxLength:Z,className:`rounded-lg border bg-white dark:bg-gray-900 px-3 py-2 outline-none focus:ring-2 focus:ring-[#2665D6] sm:max-w-sm ${d&&d.trim().length<2?"border-red-400 dark:border-red-500":"border-gray-300 dark:border-gray-700"}`,placeholder:"Başlık"}),n.jsx("input",{value:y,onChange:e=>j(e.currentTarget.value),maxLength:ke,className:`rounded-lg border bg-white dark:bg-gray-900 px-3 py-2 outline-none focus:ring-2 focus:ring-[#2665D6] sm:max-w-md ${y&&!I.test(y)?"border-red-400 dark:border-red-500":"border-gray-300 dark:border-gray-700"}`,placeholder:"https:// veya http://...",onKeyDown:e=>{e.key==="Enter"&&I.test(y)&&B()}}),n.jsxs("button",{type:"button",onClick:B,className:"px-4 py-2 rounded-lg text-sm font-semibold text-white h-10 flex items-center gap-2",style:{background:"linear-gradient(135deg, #2665D6 0%, #E6291B 100%)"},children:[Q&&n.jsx("span",{className:"w-4 h-4 border-2 border-white/60 border-t-white rounded-full animate-spin"}),n.jsx("span",{children:"Ekle"})]})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 py-4",children:[L&&n.jsx("div",{className:`fixed top-4 right-4 z-50 px-4 py-2 rounded-lg shadow text-white ${L.type==="success"?"bg-emerald-600":"bg-red-600"}`,children:L.message}),n.jsxs("div",{className:"lg:col-span-1 bg-white dark:bg-gray-900 rounded-2xl shadow-md p-4",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h4",{className:"font-semibold",children:"Kütüphane"}),n.jsxs("span",{className:"text-xs text-gray-500",children:[i.length," link"]})]}),n.jsxs("ul",{className:"flex flex-col gap-2",children:[i.map(e=>n.jsx("li",{className:"flex items-center justify-between gap-2 rounded-lg border border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-800/50 px-3 py-2",draggable:!0,onDragStart:a=>R(a,{linkId:e.id,from:"library"}),children:n.jsxs("div",{className:"min-w-0",children:[n.jsxs("div",{className:"text-sm font-medium truncate flex items-center gap-2",title:`id: ${e.id}`,children:[e.favicon&&n.jsx("img",{src:e.favicon,alt:"icon",className:"w-4 h-4 shrink-0 rounded",onError:a=>{a.currentTarget.style.display="none"}}),n.jsx("span",{className:"truncate",children:e.text})]}),n.jsx("div",{className:"text-xs text-gray-500 truncate",children:e.url})]})},e.id)),i.length===0&&n.jsx("li",{className:"text-xs text-gray-500",children:"Henüz link eklenmedi."})]})]}),n.jsx("div",{className:"lg:col-span-3 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:t.map(e=>n.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-2xl shadow-md p-4",onDragOver:ne,onDrop:a=>se(a,e.id),children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h4",{className:"font-semibold truncate pr-2",children:e.name}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("span",{className:"text-xs text-gray-500",children:[e.links.length," link"]}),n.jsx("button",{type:"button",onClick:()=>re(e.id),className:"p-1.5 rounded-md hover:bg-gray-50 dark:hover:bg-gray-800","aria-label":"Grubu sil",children:n.jsx("i",{className:"pi pi-trash text-xs"})})]})]}),n.jsxs("ul",{className:"flex flex-col gap-2",children:[e.links.map((a,l)=>n.jsxs("li",{className:"group flex items-center justify-between gap-2 rounded-lg border border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800 px-3 py-2 cursor-move",draggable:!0,onDragStart:c=>R(c,{linkId:a.id,from:"group",fromGroupId:e.id}),onDragOver:c=>c.preventDefault(),onDrop:c=>U(c,e.id,l),children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx("i",{className:"pi pi-grip-vertical text-gray-400"}),n.jsxs("div",{className:"truncate",children:[n.jsxs("div",{className:"text-sm font-medium truncate flex items-center gap-2",title:`id: ${a.id}`,children:[a.favicon&&n.jsx("img",{src:a.favicon,alt:"icon",className:"w-4 h-4 shrink-0 rounded",onError:c=>{c.currentTarget.style.display="none"}}),n.jsx("span",{className:"truncate",children:a.text})]}),n.jsx("a",{href:a.url,target:"_blank",rel:"noreferrer",className:"text-xs text-[#2665D6] hover:underline truncate block",children:a.url})]})]}),n.jsx("button",{type:"button",onClick:()=>te(e.id,a.id),className:"opacity-0 group-hover:opacity-100 transition-opacity text-xs px-2 py-1 rounded-md border border-gray-300 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800",children:"Sil"})]},a.id)),n.jsx("li",{className:"h-8 rounded-md border border-dashed border-gray-300 dark:border-gray-700 flex items-center justify-center text-xs text-gray-400",onDragOver:a=>a.preventDefault(),onDrop:a=>U(a,e.id,e.links.length),children:"Bırak"})]})]},e.id))})]})]})}export{Ne as default};
